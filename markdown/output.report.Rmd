---
title: "MetaQuot Analystic"
output:
  html_document:
    fig_caption: yes
    highlight: null
    keep_md: yes
    theme: null
---

***
```{r echo=F}
# attach(REPORT)
copy(INFOS) %>%
  extract(
    j = TIME := time.numeric.to.posixct(TIME)
  ) %>%
  as.data.frame %>%
  htmlTable(rnames = F,
            css.table = "width: 100%; margin-top: 1em; margin-bottom: 1em;",
            col.rgroup = c("none", "#F9FAF0"),
            col.columns = c("none", "#F1F0FA"))
```

```{r echo=F}
with(PERIOD, {
  data.table(
    START = int_start(NATURE.INTERVAL),
    NATURAL.PERIOD = as.character(NATURE.PERIOD),
    TRADE.DAYS = TRADE.DAYS,
    END = int_end(NATURE.INTERVAL))
  }) %>%
  htmlTable(css.table = "width: 100%; margin-top: 1em; margin-bottom: 1em;", rnames = F)
```

```{r echo=F, fig.align='center', fig.width=10, message=FALSE, warning=FALSE}
TIMESERIE.ACCOUNT %>%
  extract(j = .(TIME, EQUITY, MARGIN.FREE, MARGIN.USED)) %>%
  melt('TIME') %>% {
    ggplot(.) +
      geom_line(aes(x = TIME, y = value, color = variable)) +
      facet_grid(variable ~ ., scales = 'free_y') +
      xlab('EQUITY & MARGIN') +
      ylab(NULL) +
      theme(legend.position = 'none', axis.ticks.x = element_blank()) +
      scale_y_continuous(labels = scales::dollar)
  }
```

```{r echo=F, fig.align='center', fig.width=10, message=FALSE, warning=FALSE}
lables <- c(BALANCE.DELTA = 'PROFIT', NET.VOLUME = 'VOLUME')
melt(SYMBOLS.PROFIT_VOLUME, c('TIME', 'SYMBOL')) %>% {
  ggplot(.) +
  geom_line(aes(x = TIME, y = value, color = SYMBOL)) +
  facet_grid(variable ~ ., scales = 'free_y', labeller = labeller(variable = lables)) +
  xlab(NULL) +
  ylab(NULL) +
  theme(legend.position = 'bottom', legend.direction = 'horizontal', legend.key.size = unit(8, 'pt'),
        legend.title = element_blank(), panel.background = element_blank())
}
```

```{r echo=F}
yield.calendar(TIMESERIE.ACCOUNT)%>%
  htmlTable(css.table = "width: 100%; margin-top: 1em; margin-bottom: 1em;", rnames = F)
mddp.calendar(TIMESERIE.ACCOUNT)%>%
  htmlTable(css.table = "width: 100%; margin-top: 1em; margin-bottom: 1em;", rnames = F)
```


```{r echo=F}
TICKETS.EDITED[, c('TICKET', 'OTIME', 'TYPE', 'VOLUME', 'SYMBOL', 'OPRICE', 'SL', 'TP',
                   'CTIME', 'CPRICE', 'COMMISSION', 'TAXES', 'SWAP', 'PROFIT', 'PERIOD', 'MFP', 'MFPP', 'MFL', 'MFLP')] %>%
  htmlTable(rnames = F,
            css.table = "width: 100%; margin-top: 1em; margin-bottom: 1em;",
            col.rgroup = c('none', '#F9FAF0'),
            col.columns = c("none", "#F1F0FA"))
```

